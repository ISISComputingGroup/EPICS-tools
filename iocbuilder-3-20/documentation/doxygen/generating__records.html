<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>iocbuilder: Creating records using \c iocbuilder</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">iocbuilder Python Module</a>
  </div>
</div>
<div class="contents">
<p>Individual records can easily be added to an IOC definition, either as standalone records, or bound to hardware resources. For example, the following builder script generates 'ai' and 'waveform' records on an 8401 ADC card.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">import</span> iocbuilder
iocbuilder.ConfigureIOC()
from iocbuilder <span class="keyword">import</span> *

ModuleVersion(<span class="stringliteral">&#39;ipac&#39;</span>,       <span class="stringliteral">&#39;2-8dls4-3&#39;</span>)
ModuleVersion(&#39;Hy8401ip&#39;,   &#39;3-11&#39;)

card4 = hardware.Hy8002(4)
adc = card4.Hy8401(0)

SetDomain(&#39;TS&#39;, &#39;XX&#39;)
SetDevice(&#39;DEV&#39;, 1)

recs = []
for i in range(8):
    ch = adc.channel(i)
    recs.extend([
        ch.ai(&#39;AI%d&#39; % (i+1), EGU = &#39;V&#39;, PREC = 4),
        ch.waveform(&#39;WF%d&#39; % (i+1), NELM = 1024, FTVL = &#39;FLOAT&#39;)])
fan = create_fanout(&#39;TRIGGER&#39;, SCAN = &#39;1 second&#39;, *recs)
records.bo(&#39;GO&#39;, FLNK = fan)

WriteIoc(&#39;iocs&#39;, &#39;TS&#39;, &#39;XX&#39;, 1)
</pre></div><p>We've already seen what the first lines do, so let's start with the following new definitions.</p>
<h2><a class="anchor" id="naming">
Record naming</a></h2>
<div class="fragment"><pre class="fragment">SetDomain(<span class="stringliteral">&#39;TS&#39;</span>, <span class="stringliteral">&#39;XX&#39;</span>)
SetDevice(&#39;DEV&#39;, 1)
</pre></div><p>The default record naming convention (as configured by ConfigureIOC(), as it happens) strictly follows the Diamond naming convention, where every record name is of the form </p>
<div class="fragment"><pre class="fragment">&lt;domain&gt;-&lt;ta&gt;-&lt;component&gt;-&lt;<span class="keywordtype">id</span>&gt;:&lt;name&gt;
</pre></div><p> Here we specify the first four components in the same order -- all records will then assume this "device" name -- thus in this case we will be generating records named <code>TS-XX-DEV-01:&lt;name&gt;</code>, where <code>&lt;name&gt;</code> is specified when we generate the record.</p>
<h2><a class="anchor" id="hardware">
Hardware bound records</a></h2>
<div class="fragment"><pre class="fragment">    ch = adc.channel(i)
    ch.ai(<span class="stringliteral">&#39;AI%d&#39;</span> % (i+1), EGU = <span class="charliteral">&#39;V&#39;</span>, PREC = 4)
    ch.waveform(<span class="stringliteral">&#39;WF%d&#39;</span> % (i+1), NELM = 1024, FTVL = <span class="stringliteral">&#39;FLOAT&#39;</span>)
</pre></div><p>This part of the code above simply extracts one of the eight ADC channels and then generates an ai record named <code>AI1</code> for the first channel (and so on up to <code>AI8</code>), and similarly waveform records named <code>WF1</code> to <code>WF8</code>.</p>
<p>The true record name is then generated from the device configured above to construct records with full names of the form <code>TS-XX-DEV-01:AI1</code> and so on.</p>
<p>Individual fields in each record can be specified during construction of the record (or fields can be assigned after construction). All fields and values are validated against the dbd file where the record type is defined. The <code>DTYP</code> and <code>INP</code> fields are automatically assigned, as these records are bound to hardware entities.</p>
<h2><a class="anchor" id="fan">
Generating fanout records</a></h2>
<div class="fragment"><pre class="fragment">recs = []
<span class="keywordflow">for</span> i in range(8):
    recs.extend([ ... ])
fan = <a class="code" href="namespaceiocbuilder_1_1fanout.html#abea43e711cf9a16f74e5ad4b748ed2de" title="Creates one or more fanout records (as necessary) to fan processing out to a list...">create_fanout</a>(<span class="stringliteral">&#39;TRIGGER&#39;</span>, SCAN = <span class="stringliteral">&#39;1 second&#39;</span>, *recs)
</pre></div><p>All the records generated in the loop are gathered together into a single list -- and then create_fanout() is used to create a chain of fanout records. This idiom allows the records to be processed together in a controlled way.</p>
<h2><a class="anchor" id="unbound">
Generating unbound records</a></h2>
<div class="fragment"><pre class="fragment"><a class="code" href="namespaceiocbuilder_1_1dbd.html#ad4b17e59cbd32e2be9e0490e6f73501d" title="Every record type loaded from a DBD is present as an attribute of this class with...">records</a>.bo(<span class="stringliteral">&#39;GO&#39;</span>, FLNK = fan)
</pre></div><p>The <code>records</code> object contains an attribute for each record type (automatically populated from dbd files), and can be used to create arbitrary records. In this case we are generating a record named <code>TS-XX-DEV-01:GO</code> with its forward link set to the previously created fanout -- thus processing <code>GO</code> will trigger all the records in this example. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
