<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>iocbuilder: Creating an IOC using the xml front end</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">iocbuilder Python Module</a>
  </div>
</div>
<div class="contents">
<p>This page will walk through creating a simple IOC using the xmlbuilder gui front end to iocbuilder</p>
<h2><a class="anchor" id="pre">
Prerequisites</a></h2>
<ul>
<li>Run the <code>dls-make-etc-dir.py</code> script to create an <code>etc</code> directory.</li>
</ul>
<h2><a class="anchor" id="dir">
Directory structure</a></h2>
<ul>
<li><code>&lt;module&gt;/etc/makeIocs/&lt;iocname&gt;_RELEASE</code> is an optional file that specifies module dependencies that are not captured in <code>&lt;module&gt;/configure/RELEASE</code> </li>
<li><code>&lt;module&gt;/etc/makeIocs/&lt;iocname&gt;.xml</code> is an XML file that containts elements representing builder objects. The xmlbuilder module can create iocbuilder objects from this file, and the <code>xeb.py</code> application is included to edit this file.</li>
</ul>
<h2><a class="anchor" id="ex">
Example</a></h2>
<p>Following the steps below will create a simple IOC with a single instance of a eurotherm2k controller. If you want to try this out for yourself you can copy <code>example_ioc.xml</code> and <code>example_ioc_RELEASE</code> from <code>&lt;iocbuilder&gt;/documentation/examples/</code> to <code>&lt;module&gt;/etc/makeIocs/</code> Typing <code>make</code> in the <code>&lt;module&gt;/etc/makeIocs/</code> directory will create an IOC <code>example_ioc</code> in <code>&lt;module&gt;/iocs/example_ioc</code> </p>
<h3><a class="anchor" id="ex1">
&lt;iocname&gt;_RELEASE</a></h3>
<p>The following text is from <code>&lt;iocbuilder&gt;/documentation/examples/example_ioc_RELEASE</code> </p>
<div class="fragment"><pre class="fragment">SUPPORT=/dls_sw/prod/R3.14.8.2/support
WORK=/dls_sw/work/R3.14.8.2/support

<span class="preprocessor"># Place any example specific dependencies here</span>
<span class="preprocessor"></span>PYDRV=          $(SUPPORT)/pyDrv/1-2
STREAMDEVICE=   $(SUPPORT)/streamDevice/2-4dls2-1
EUROTHERM2K=    $(WORK)/eurotherm2k
</pre></div><p> This is just a standard RELEASE file that lists paths to other modules. The iocbuilder will walk the tree of <code>&lt;module&gt;/configure/RELEASE</code> and <code>&lt;iocname&gt;_RELEASE</code> if it exists, and import the relevant builder files from these modules in depth first order (i.e. all dependencies of a module before the module itself).</p>
<h3><a class="anchor" id="ex2">
&lt;iocname&gt;.py</a></h3>
<p>The following text is from <code>&lt;iocbuilder&gt;/documentation/examples/example_ioc</code>.xml </p>
<div class="fragment"><pre class="fragment">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> ?&gt;
&lt;components arch=<span class="stringliteral">&quot;linux-x86&quot;</span>&gt;
        &lt;pyDrv.serial_sim_instance IPPort=<span class="stringliteral">&quot;8100&quot;</span> module=<span class="stringliteral">&quot;eurotherm2k_sim&quot;</span> name=<span class="stringliteral">&quot;eurothermSim&quot;</span> pyCls=<span class="stringliteral">&quot;eurotherm2k&quot;</span> rpc=<span class="stringliteral">&quot;9001&quot;</span>/&gt;
        &lt;asyn.AsynIP name=<span class="stringliteral">&quot;eurothermAsyn&quot;</span> port=<span class="stringliteral">&quot;172.23.111.180:7001&quot;</span> simulation=<span class="stringliteral">&quot;eurothermSim&quot;</span>/&gt;
        &lt;eurotherm2k.eurotherm2k GAD=<span class="stringliteral">&quot;0&quot;</span> LAD=<span class="stringliteral">&quot;1&quot;</span> P=<span class="stringliteral">&quot;EUROTHERM2K&quot;</span> PORT=<span class="stringliteral">&quot;eurothermAsyn&quot;</span> Q=<span class="stringliteral">&quot;&quot;</span>/&gt;
&lt;/components&gt;
</pre></div><ul>
<li>The <code>&lt;components&gt;</code> element represents the IOC and provides<ul>
<li>a root node to place objects under</li>
<li>a place to specify the architecture for the real IOC</li>
</ul>
</li>
<li>Each element under the <code>&lt;components&gt;</code> element represents a builder object and each of its attributes is a named argument</li>
</ul>
<h2><a class="anchor" id="build">
Building the IOC</a></h2>
<p>The make rule runs <code>dls-xml-iocbuilder.py</code> which reads the xml file. For each element it creates the corresponding builder element and then writes out the IOC. It has a debug mode where it will write the python calls it makes to stdout, and a simulation mode to write a simulation output.</p>
<h2><a class="anchor" id="xeb">
xeb.py</a></h2>
<p>You can hand edit the xml file if you want, but the most useful way to edit it is with the gui tool <code>xeb.py</code> </p>
<p>If you run the following: </p>
<div class="fragment"><pre class="fragment">[tmc43@pc0043 eurotherm2k]$$ xeb.py &lt;module&gt;/etc/makeIocs/example_ioc.xml
</pre></div><p> You will be presented with the gui: </p>
<div align="center">
<img src="ss1.png" alt="ss1.png"/>
<p><strong>Gui snapshot</strong></p></div>
<p>As you can see, the main window is split into 3 sections, the <a class="el" href="using__xmlbuilder.html#table_sec">Table selector</a> on the top left, the <a class="el" href="using__xmlbuilder.html#undo_sec">Undo stack</a> on the bottom left and the <a class="el" href="using__xmlbuilder.html#object_sec">Table editor</a> on the right, with a <a class="el" href="using__xmlbuilder.html#menu_sec">Menu bar</a> along the top.</p>
<h3><a class="anchor" id="table_sec">
Table selector</a></h3>
<p>The table selector shows an entry for each builder class that has objects defined. If you click on one of them, the table is displayed in the <a class="el" href="using__xmlbuilder.html#object_sec">Table editor</a>. If you right click you will be presented with the <a class="el" href="using__xmlbuilder.html#component_menu">Components menu</a></p>
<h3><a class="anchor" id="undo_sec">
Undo stack</a></h3>
<p>This contains a list of the actions that have been performed on the visible table. You can click up and down to undo and redo actions</p>
<h3><a class="anchor" id="object_sec">
Table editor</a></h3>
<p>In this pane you are presented with a spreadsheet view of the current table. If you mouse over a value you will be shown a tooltip describing that argument. If there are a choice of values for a field they will also be shown in the tooltip as well as being autocomplete options. If you right click you will be presented with the <a class="el" href="using__xmlbuilder.html#edit_menu">Edit menu</a></p>
<p>The cells are colourcoded as follows:</p>
<ul>
<li>White background: Required argument</li>
<li>Yellow background: Optional argument</li>
<li>Shaded background: Cell selected</li>
<li>Black text: Normal value</li>
<li>Grey text: No value entered, default value shown</li>
<li>Red text and background: Invalid value</li>
</ul>
<div align="center">
<img src="ss2.png" alt="ss2.png"/>
<p><strong>Editing an object</strong></p></div>
 <h3><a class="anchor" id="menu_sec">
Menu bar</a></h3>
<p>This contains the following menus:</p>
<h3><a class="anchor" id="file_menu">
File menu</a></h3>
<div style="position:relative; left:30px; top:0px; height:190px; width:187px"> <div align="center">
<img src="ss3.png" alt="ss3.png"/>
</div>
 </div><ul>
<li>New: Create a new xml data structure</li>
<li>Open: Open an existing xml file</li>
<li>Reload: Reopen the current xml file</li>
<li>Save: Save as current xml file</li>
<li>Save As: Save as different xml file</li>
<li>Set Architecture: Set the architecture of the file</li>
</ul>
<h3><a class="anchor" id="edit_menu">
Edit menu</a></h3>
<div style="position:relative; left:30px; top:0px; height:271px; width:231px"> <div align="center">
<img src="ss4.png" alt="ss4.png"/>
</div>
 </div><ul>
<li>Insert Row: Insert a row above the currently selected row(s)</li>
<li>Insert Row Under: Insert a row below the currently selected row(s)</li>
<li>Remove Row: Delete the currently selected row(s)</li>
<li>Cut: Cut the contents of the table to the clipboard</li>
<li>Copy: Copy the contents of the table to the clipboard</li>
<li>Paste: If the clipboard contains 1 value and there is a multi-cell selection then paste the value to all cells, otherwise paste the contents from the top left cell selection</li>
<li>Clear: Clear the selected cell(s)</li>
<li>Fill Cells: Take the top left cell and fill down and across, incrementing trailing integer values. E.g. if cell(0,0) = "Text1", cells (0,0) -&gt; (0,2) are selected and Fill cells clicked, cell(0,1) = "Text2" and cell(0,2) = "Text3"</li>
<li>Undo: Undo the last action on the selected table</li>
<li>Redo: Redo the last action on the selected table </li>
</ul>
<h3><a class="anchor" id="component_menu">
Components menu</a></h3>
<div style="position:relative; left:30px; top:0px; height:157px; width:131px"> <div align="center">
<img src="ss5.png" alt="ss5.png"/>
</div>
 </div><ul>
<li>Remove Table: Remove the currently selected table (its objects are not deleted until the file is saved)</li>
<li>Each remaining menu is the name of a support module, clicking on it will open a sub-menu which contains all the builder classes that the module provides. Clicking on one of these menu items will display it in the <a class="el" href="using__xmlbuilder.html#object_sec">Table editor</a></li>
<li>The records submenu contains all the record types that are available to instantiate. More details in <a class="el" href="using__xmlbuilder.html#xmlbuilder_rec">Creating records from xmlbuilder</a></li>
</ul>
<h2><a class="anchor" id="xmlbuilder_rec">
Creating records from xmlbuilder</a></h2>
<div align="center">
<img src="ss6.png" alt="ss6.png"/>
<p><strong>Editing records in xeb.py</strong></p></div>
<p>At the moment there is limited record support in xmlbuilder. You can create named records of the supported types, but as dbds are not intelligently instantiated none of the <code>DTYP</code> information is validated correctly. This will be fixed in a future release. You can access record information from the record submenu of the <a class="el" href="using__xmlbuilder.html#component_menu">Components menu</a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
